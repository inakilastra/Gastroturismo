<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provincias de <?= (typeof autonomia !== "undefined" && autonomia && autonomia.nombre) ? autonomia.nombre : "Comunidad Autónoma" ?> - ANeKI Gastroturismo</title>
    <meta name="description" content="Descubre las provincias y la riqueza gastronómica de <?= (typeof autonomia !== "undefined" && autonomia && autonomia.nombre) ? autonomia.nombre : 'una comunidad autónoma' ?>.">
    <?!= include('css'); ?>
</head>
<body>
    <?!= include('navbar'); ?>

    <main class="main-content">
        <div class="container page-detail-container">
            <div class="page-detail-card">
                <? 
                  // Lógica para determinar qué mostrar, mejorada para claridad
                  var nombreAutonomiaParam = ""; // Nombre de la autonomía desde el parámetro URL
                  var datosAutonomia = null;     // Objeto con los datos de la autonomía (nombre, tipo, provincias)
                  var mensajeError = "";
                  var mostrarContenido = false;

                  // 1. Obtener el nombre de la autonomía del parámetro URL (esto se hace en el backend .gs)
                  // En el HTML, asumimos que la variable 'autonomia' ya ha sido procesada por el backend.
                  // 'autonomia' podría ser un objeto como:
                  // { nombre: "Andalucía", tipo: "Comunidad Autónoma Histórica", listaDeProvincias: ["Almería", "Cádiz", ...], error: null }
                  // o { error: "Autonomía no encontrada" }

                  if (typeof autonomia !== "undefined" && autonomia) {
                      if (autonomia.error) {
                          mensajeError = autonomia.error;
                          if (autonomia.nombre && autonomia.nombre !== "N/D" && autonomia.nombre !== autonomia.error) {
                              // Añade el nombre de la autonomía al error si es útil
                              mensajeError += " (Referencia: " + autonomia.nombre + ")";
                          }
                      } else if (autonomia.nombre && autonomia.nombre !== "N/D") {
                          datosAutonomia = autonomia; // Tenemos datos válidos
                          mostrarContenido = true;
                          nombreAutonomiaParam = autonomia.nombre; // Guardamos el nombre para el título y otros usos
                      } else {
                          mensajeError = "No se encontraron datos válidos para la comunidad autónoma especificada.";
                      }
                  } else {
                      mensajeError = "Error crítico: No se pudo cargar la información de la comunidad autónoma. Por favor, inténtalo de nuevo desde la página principal.";
                  }
                ?>

                <? if (mostrarContenido && datosAutonomia) { ?>
                    <h1><?= datosAutonomia.nombre ?></h1>
                    
                    <? if (datosAutonomia.tipo) { ?>
                        <p><span class="data-label">Tipo:</span> <?= datosAutonomia.tipo ?></p>
                    <? } ?>

                    <p><span class="data-label">Provincias:</span></p>
                    <? if (datosAutonomia.listaDeProvincias && Array.isArray(datosAutonomia.listaDeProvincias) && datosAutonomia.listaDeProvincias.length > 0) { ?>
                        <ul class="items-list provincias-list">
                            <? for (var i = 0; i < datosAutonomia.listaDeProvincias.length; i++) { ?>
                                <li><?= datosAutonomia.listaDeProvincias[i] ?></li>
                            <? } ?>
                        </ul>
                    <? } else if (datosAutonomia.listaDeProvincias === null) { ?>
                        <p class="info-text">No se pudo cargar la información de las provincias para <?= datosAutonomia.nombre ?>. Es posible que esta comunidad no tenga provincias detalladas en nuestro sistema o hubo un error al obtenerlas.</p>
                    <? } else { // Lista vacía o no es un array válido ?>
                        <p class="info-text">No hay provincias específicas listadas para <?= datosAutonomia.nombre ?> en este momento, o la información no está disponible.</p>
                    <? } ?>

                <? } else { ?>
                    <h1>Información no Disponible</h1>
                    <p class="error-message"><?= mensajeError ? mensajeError : "Ha ocurrido un error inesperado." ?></p>
                <? } ?>

                <div class="back-button-container">
                    <a href="<?= ScriptApp.getService().getUrl() ?>?vista=Index#autonomias" class="btn btn-secondary">
                        <span aria-hidden="true">&larr;</span> Volver a Comunidades Autónomas
                    </a>
                </div>
            </div>
        </div>
    </main>

    <?!= include('footer'); ?>
    <script>
        // Script para manejar el menú hamburguesa (si no está en navbar-js)
        const burgerToggle = document.getElementById('burger-toggle');
        const navLinks = document.querySelector('.nav-links');

        if (burgerToggle && navLinks) {
             navLinks.addEventListener('click', (event) => {
                if (event.target.tagName === 'A') {
                    burgerToggle.checked = false;
                }
            });
        }
    </script>
</body>
</html>
