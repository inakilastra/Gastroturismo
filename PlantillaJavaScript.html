<!-- PlantillaJavaScript.html -->
<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
<script>
  // Variable global para guardar la instancia del drawer.
  // Es crucial para que podamos abrir/cerrar el menú desde cualquier función.
  let mdcDrawerInstance = null;

  /**
   * Carga el contenido de una página dinámicamente.
   * @param {string} pageName El nombre del fichero de contenido (ej. "inicio", "tapeo").
   * @param {HTMLElement} clickedElement El elemento <a> en el que se hizo clic.
   */
  function loadPage(pageName, clickedElement) {
    const contentArea = document.getElementById('main-content-area');
    contentArea.innerHTML = '<div style="text-align:center; padding: 40px;">Cargando...</div>'; 

    google.script.run
      .withSuccessHandler(function(htmlContent) {
        contentArea.innerHTML = htmlContent;
        
        // Resalta el elemento del menú que está activo.
        document.querySelectorAll('#main-nav .mdc-list-item').forEach(item => {
          item.classList.remove('mdc-list-item--activated');
        });
        if (clickedElement) {
          clickedElement.classList.add('mdc-list-item--activated');
        }

        // Cierra el menú si está abierto y es de tipo modal.
        if (mdcDrawerInstance && mdcDrawerInstance.open) {
          mdcDrawerInstance.open = false;
        }
      })
      .withFailureHandler(function(error) {
        contentArea.innerHTML = `<div style="text-align:center; padding: 40px; color: red;">Error al cargar la página: ${error.message}</div>`;
      })
      .getPageContent(pageName);
  }

  // Se ejecuta una sola vez cuando la página inicial está cargada.
  document.addEventListener('DOMContentLoaded', function() {
    const drawerElement = document.querySelector('.mdc-drawer');
    const menuButton = document.querySelector('.mdc-top-app-bar__navigation-icon');
    
    // Inicializar los efectos "ripple" en los botones que ya existen.
    const ripples = Array.from(document.querySelectorAll('.mdc-button, .mdc-icon-button, .mdc-list-item'));
    ripples.forEach(el => mdc.ripple.MDCRipple.attachTo(el));

    if (drawerElement && menuButton) {
      // 1. Inicializa el componente del Drawer y lo guarda en nuestra variable global.
      mdcDrawerInstance = mdc.drawer.MDCDrawer.attachTo(drawerElement);

      // 2. Añade un listener de clic directo al botón del menú.
      menuButton.addEventListener('click', () => {
        mdcDrawerInstance.open = !mdcDrawerInstance.open;
      });

      console.log("Menú y botón conectados correctamente.");

    } else {
      console.error("No se encontró el elemento .mdc-drawer o el botón del menú. El menú no funcionará.");
    }

    // Carga la página de inicio al arrancar la aplicación
    const firstNavLink = document.querySelector('#main-nav a.mdc-list-item');
    if (firstNavLink) {
      loadPage('inicio', firstNavLink); 
    } else {
      loadPage('inicio', null);
    }
  });
</script>

<!--
<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
<script>
  // Instancia global del drawer para acceso desde cualquier función
  window.mdcDrawerInstance = null;

  // Inicialización de los componentes MDC una sola vez
  document.addEventListener('DOMContentLoaded', function() {
    // Drawer
    const drawerElement = document.querySelector('.mdc-drawer');
    if (drawerElement) {
      window.mdcDrawerInstance = mdc.drawer.MDCDrawer.attachTo(drawerElement);
    }

    // Top App Bar
    const topAppBarElement = document.querySelector('.mdc-top-app-bar');
    if (topAppBarElement) {
      const topAppBar = mdc.topAppBar.MDCTopAppBar.attachTo(topAppBarElement);
      topAppBar.setScrollTarget(document.querySelector('.main-app-content'));
      topAppBar.listen('MDCTopAppBar:nav', () => {
        if (window.mdcDrawerInstance) {
          window.mdcDrawerInstance.open = !window.mdcDrawerInstance.open;
        }
      });
    }

    // Efecto ripple en botones y elementos interactivos
    document.querySelectorAll('.mdc-button, .mdc-icon-button, .mdc-list-item')
      .forEach(el => mdc.ripple.MDCRipple.attachTo(el));
  });

  /**
   * Carga el contenido de una página dinámicamente sin recargar.
   * @param {string} pageName El nombre del fichero de contenido a cargar (ej. "Index", "Tapeo").
   * @param {HTMLElement} clickedElement El elemento <a> en el que se hizo clic.
   */
  function loadPage(pageName, clickedElement) {
    const contentArea = document.getElementById('main-content-area');
    contentArea.innerHTML = '<div style="text-align:center; padding: 40px;">Cargando...</div>'; 

    google.script.run
      .withSuccessHandler(function(htmlContent) {
        contentArea.innerHTML = htmlContent;

        // Activar visualmente el menú seleccionado
        document.querySelectorAll('#main-nav .mdc-list-item').forEach(item => {
          item.classList.remove('mdc-list-item--activated');
        });
        if (clickedElement) {
          clickedElement.classList.add('mdc-list-item--activated');
        }

        // Cerrar el drawer si está abierto (ideal para móviles)
        if (window.mdcDrawerInstance && window.mdcDrawerInstance.open) {
          window.mdcDrawerInstance.open = false;
        }
      })
      .withFailureHandler(function(error) {
        contentArea.innerHTML = `<div style="text-align:center; padding: 40px; color: red;">Error al cargar la página: ${error.message}</div>`;
      })
      .getPageContent(pageName);
  }
</script>
-->